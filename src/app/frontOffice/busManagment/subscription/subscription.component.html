<app-header-front></app-header-front>

<main id="main" class="main">

  <div class="container" #content>
    <div class="row">
      <div class="col-md-6 offset-md-3">
        <div class="card-deck mt-5">
          <div class="card" *ngFor="let s of listSub">
            <div class="card-body">
              <h5 class="card-title">Subscription Details</h5>
              <div class="container mt-3"></div>

              <ul class="list-group list-group-flush">

                <li class="list-group-item"><strong>Remaining Trips:</strong> {{ s.remainingTrips }}</li>
                <li class="list-group-item"><strong>Trip Stops:</strong> {{ s.tripStops }}</li>
                <li class="list-group-item"><strong>Payment Method:</strong> {{ s.subscriptionPaymentMethod }}</li>
                <li class="list-group-item"><strong>Status:</strong> {{ s.status }}</li>
                <li class="list-group-item"><strong>Price:</strong> {{ s.subscriptionPrice }}</li>
                


              </ul>
              <div class="btn-group mt-3" role="group">
                <button type="button" class="btn btn-danger" (click)="removeSubscription(s.id)">Cancel Subscription</button>
                <button type="button" class="btn"
                    [ngClass]="{'btn-success': s.status === 'ACTIVE', 'btn-dark': s.status !== 'ACTIVE'}"
                    (click)="openPaymentModal(s)"
                    [disabled]="s.status === 'ACTIVE' || s.subscriptionPaymentMethod === 'CASH'">
                    <i class="fas fa-money-bill-alt mr-2"></i>
                    {{ s.status === 'ACTIVE' ? 'Paid‚úîÔ∏è' : (s.subscriptionPaymentMethod === 'CASH' ? 'Pay Cashüí≤' : 'Payüí≥') }}
                    <ng-container *ngIf="s.status === 'ACTIVE'">
                      <i class="fas fa-check-circle text-success ml-1"></i>
                    </ng-container>
                  </button>
                <button type="button" class="btn btn-success" (click)="generateQrCode(s)">Generate QR Code</button>
              </div>
              <div class="mt-3 text-center">
                <img *ngIf="s.qrCodeImageUrl" [src]="s.qrCodeImageUrl" alt="QR Code" class="img-fluid">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Modal de d√©tails de paiement -->
<div id="paymentModal" class="modal" *ngIf="selectedsub">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Payment Details</h5>
        <button type="button" class="close" (click)="closePaymentModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="subForm" (ngSubmit)="paySubscription(selectedsub)">
          <div class="form-group">
            <label for="cardNumber">Card Number:</label>
            <input type="text" id="cardNumber" class="form-control" formControlName="cardNumber" placeholder="1234 1234 1234 1234 " (input)="formatCardNumber($event)" required>
            <div *ngIf="subForm.get('cardNumber')?.hasError('invalidLength')" class="invalid-feedback">
              Card number must be exactly 16 digits.
            </div>
            <div *ngIf="isInvalidControl('cardNumber')" class="invalid-feedback">
              Please provide a valid card number.
            </div>
          </div>


          <div class="form-row">
            <div class="form-group">
              <label for="expirationDate">Expiration Date:</label>
              <input type="text" id="expirationDate" class="form-control" formControlName="expirationDate" placeholder="MM/YYYY" required>
              <div *ngIf="isInvalidControl('expirationDate')" class="invalid-feedback">
                Please provide a valid expiration date (MM/YYYY).
              </div>
            </div>
            <div class="form-group">
              <label for="securityCode">Security Code:</label>
              <div class="input-group">
                <input type="{{ securityCodeVisible ? 'text' : 'password' }}" id="securityCode" class="form-control" formControlName="securityCode" maxlength="4" placeholder="****" required>
                <div class="input-group-append">
                  <label class="input-group-text" (click)="toggleSecurityVisibility()" style="cursor: pointer;">
                    <span>üëÅÔ∏è‚Äçüó®Ô∏è</span>
                  </label>
                </div>
              </div>
              <div *ngIf="isInvalidControl('securityCode')" class="invalid-feedback">
                Please provide a valid security code (4 digits).
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closePaymentModal()">Close</button>
        <button type="button" class="btn btn-success"
          (click)="paySubscription(selectedsub)"
          [disabled]="subForm.invalid">
          Pay {{ selectedsub.subscriptionPrice }} DT
        </button>
      </div>
    </div>
  </div>
</div>

<app-footer-front></app-footer-front>
